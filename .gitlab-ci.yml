image: python:3-slim-bookworm

stages:
  - deploy

pages:
  stage: deploy
  before_script:
    - scripts/setup_env.sh --docs-only
  script:
    - scripts/build_docs_versioned.py $CI_COMMIT_REF_NAME public
  artifacts:
    paths:
      - public
  rules:
    - if: '$CI_COMMIT_BRANCH == "master"'
    - if: '$CI_COMMIT_BRANCH == "develop"'


package:
  stage: deploy
  before_script:
    - scripts/setup_env.sh
  script:
    - scripts/build_package.sh
    - scripts/upload_package.sh $PYPI_ACCOUNT $PYPI_PASSWORD
  rules:
    - if: $CI_COMMIT_TAG && $CI_COMMIT_REF_PROTECTED == "true" && '$CI_COMMIT_BRANCH == master'

